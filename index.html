<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Task & Calendar Manager</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>
                <!-- Add this inside the <head> section -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
        <style>
            :root {
        --dark-bg: #1a1a1a;
        --darker-bg: #141414;
        --darkest-bg: #0a0a0a;
        --lava-red: #ff4444;
        --gray: #333333;
        --light-gray: #666666;
        --border-radius-lg: 20px;
        --border-radius-md: 15px;
        --border-radius-sm: 12px;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Helvetica', Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    body {
        background-color: var(--dark-bg);
        color: white;
        display: flex;
        min-height: 100vh;
        font-family: 'Helvetica', Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    
            .calendar-section {
                width: 30%;
                background-color: var(--darker-bg);
                padding: 20px;
                border-right: 2px solid var(--gray);
                display: flex;
                flex-direction: column;
                border-top-right-radius: var(--border-radius-lg);
                border-bottom-right-radius: var(--border-radius-lg);
            }
    
            .tasks-section {
                width: 70%;
                padding: 20px;
            }

            .section-headers {
                display: flex;
                gap: 20px;
                margin-bottom: 10px;
            }

            .section-header {
                cursor: pointer;
                transition: opacity 0.3s;
                position: relative;
            }

            .section-header.inactive {
                opacity: 0.5;
            }

            .section-header::after {
                content: '';
                position: absolute;
                bottom: -5px;
                left: 0;
                width: 0;
                height: 2px;
                background-color: var (--lava-red);
                transition: width 0.3s;
            }

            .section-header:not(.inactive):hover::after {
                width: 100%;
            }

            .content-section {
                display: none;
            }

            .content-section.active {
                display: block;
            }

            .ui-timepicker-wrapper {
                background-color: var(--gray);
                border-radius: var(--border-radius-md);
                overflow: hidden; 
            }

            .ui-timepicker-list li {
                padding: 5px;
                cursor: pointer;
            }

            .ui-timepicker-list li:hover,
            .ui-timepicker-list .ui-timepicker-selected {
                background-color: var(--lava-red); 
                color: white;
            }
    
            .calendar {
                background-color: var(--gray);
                border-radius: var(--border-radius-lg);
                padding: 15px;
                margin-bottom: 20px;
            }
    
            .calendar-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
            }
    
            .calendar-grid {
                display: grid;
                grid-template-columns: repeat(7, minmax(0, 1fr));
                gap: 0.5rem;
                padding: 0.5rem;
            }

            .calendar-grid > div:nth-child(-n + 7) {
                text-align: center;
                font-weight: 600;
                font-size: 0.9em;
                padding: 0.5rem 0;
            }
                
            .calendar-day {
                position: relative;
                width: 100%;
                padding-top: 100%; /* Creates a perfect square */
            }

            .calendar-day span {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                background-color: var(--dark-bg);
                border-radius: 50%;
                cursor: pointer;
                transition: background-color 0.3s;
            }

            .calendar-day:hover span {
                background-color: var(--lava-red);
            }

            .calendar-day.active span {
                background-color: var(--lava-red);
            }
                
            .calendar-day.has-events::after {
                content: '';
                position: absolute;
                bottom: 10%;
                left: 50%;
                transform: translateX(-50%);
                width: 0.5rem;
                height: 0.5rem;
                background-color: var(--lava-red);
                border-radius: 50%;
            }
    
            .task-input {
                width: 100%;
                padding: 12px;
                background-color: var(--gray);
                border: none;
                border-radius: var(--border-radius-md);
                color: white;
                margin-bottom: 20px;
                font-family: inherit;
            }
    
            .task-list {
                list-style: none;
            }
    
            .task-item {
        display: flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.1); /* Light transparent background */
        padding: 12px;
        margin-bottom: 10px;
        border-radius: 15px; /* Increase this value as desired */
        transition: opacity 0.3s;
        backdrop-filter: blur(10px); /* Blur effect */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow */
        border: 1px solid rgba(255, 255, 255, 0.2); /* Light border */
    }
    
            .task-item.completed {
                text-decoration: line-through;
                opacity: 0.3;
            }

            .goal-item {
        display: flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.1); /* Light transparent background */
        padding: 12px;
        margin-bottom: 10px;
        border-radius: var(--border-radius-md);
        transition: all 0.3s;
        backdrop-filter: blur(10px); /* Blur effect */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow */
        border: 1px solid rgba(255, 255, 255, 0.2); /* Light border */
    }

            .goal-progress {
                margin-left: auto;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .progress-bar {
                width: 100px;
                height: 6px;
                background-color: var(--dark-bg);
                border-radius: 3px;
                overflow: hidden;
            }

            .progress-fill {
                height: 100%;
                background-color: var(--lava-red);
                transition: width 0.3s;
            }

            .progress-text {
                font-size: 0.8em;
                color: var(--light-gray);
            }
    
            .task-checkbox {
                margin-right: 10px;
                appearance: none;
                width: 20px;
                height: 20px;
                background-color: var(--dark-bg);
                border-radius: var(--border-radius-sm);
                cursor: pointer;
                position: relative;
            }
    
            .task-checkbox:checked {
                background-color: var(--lava-red);
            }
    
            .task-checkbox:checked::after {
                content: 'âœ“';
                position: absolute;
                color: white;
                font-size: 14px;
                left: 4px;
                top: 0px;
            }
            .calendar-day.today span {
    border: 2px solid var(--lava-red);
    background-color: var(--darker-bg);
    color: var(--lava-red);
    font-weight: bold;
}

.calendar-day.today.active span {
    background-color: var(--lava-red);
    color: white;
}
    
            .water-reminder {
                position: fixed;
                bottom: 20px;
                right: 20px;
                background-color: var(--lava-red);
                padding: 15px;
                border-radius: var(--border-radius-lg);
                display: none;
                animation: bounce 1s infinite;
            }
    
            .events-list {
                flex-grow: 1;
                background-color: var(--gray);
                border-radius: var(--border-radius-lg);
                padding: 15px;
                overflow-y: auto;
            }
    
            .event-item {
                background-color: var(--dark-bg);
                padding: 15px;
                margin-bottom: 12px;
                border-radius: var(--border-radius-md);
                border-left: 4px solid var(--lava-red);
                display: flex;
                align-items: flex-start;
                gap: 10px;
                margin-top: 10px;
            }

            .event-time {
                color: var(--lava-red);
                font-size: 1em;
                margin-right: 10px;
                flex-shrink: 0;
            }
    
            .event-form {
                display: none;
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: var(--darker-bg);
                padding: 20px;
                border-radius: var(--border-radius-lg);
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
                z-index: 1000;
            }
    
            .event-form.active {
                display: block;
            }
    
            .event-form input,
            .event-form textarea {
                width: 100%;
                padding: 8px;
                margin-bottom: 10px;
                background-color: var(--gray);
                border: none;
                border-radius: var(--border-radius-md);
                color: white;
                font-family: inherit;
            }
    
            .event-form-buttons {
                display: flex;
                justify-content: flex-end;
                gap: 10px;
            }
    
            .overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 999;
            }
    
            .overlay.active {
                display: block;
            }
    
            button {
                background-color: var(--lava-red);
                color: white;
                border: none;
                padding: 8px 15px;
                border-radius: var(--border-radius-md);
                cursor: pointer;
                transition: all 0.3s ease;
                font-family: inherit;
            }
    
            button:hover {
                background-color: #ff6666;
            }
    
            .delete-event {
                background-color: transparent;
                color: var (--lava-red);
                padding: 4px 8px;
                float: right;
                border-radius: var(--border-radius-sm);
            }
    
            #prevMonth, #nextMonth {
                width: 32px;
                height: 32px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                background-color: var(--gray);
                border: none;
                color: white;
                cursor: pointer;
                transition: background-color 0.3s;
            }

            #prevMonth:hover, #nextMonth:hover {
                background-color: var(--lava-red);
            }

            .timer-setup {
                display: none;
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: var(--darker-bg);
                padding: 20px;
                border-radius: var(--border-radius-lg);
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
                z-index: 1001;
                min-width: 300px;
            }

            .timer-setup input, 
            .timer-setup select {
                width: 100%;
                padding: 12px;
                margin-bottom: 15px;
                background-color: var(--gray);
                border: none;
                border-radius: var(--border-radius-md);
                color: white;
                font-family: inherit;
            }

            .fullscreen-timer {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--darkest-bg);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    z-index: 1002;
}

            #timerTaskName {
                font-size: 1.5rem;
                font-weight: 500;
                color: var (--light-gray);
                margin-bottom: 1rem;
                letter-spacing: 0.5px;
            }

            #timerCountdown {
                font-size: 6rem;
                font-weight: 700;
                font-family: 'Inter', monospace;
                letter-spacing: 2px;
                color: var (--lava-red);
                text-shadow: 0 0 20px rgba(255, 68, 68, 0.3);
                margin: 2rem 0;
            }

            #exitFullscreen {
                margin-top: 2rem;
                padding: 1rem 2rem;
                font-size: 1.1rem;
                font-weight: 500;
                background-color: transparent;
                border: 2px solid var(--lava-red);
                color: var(--lava-red);
                border-radius: var(--border-radius-md);
                cursor: pointer;
                transition: all 0.3s ease;
            }

            #exitFullscreen:hover {
                background-color: var(--lava-red);
                color: white;
            }
    
            @keyframes bounce {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-10px); }
            }

                        .notes-section {
                display: none;
                margin-top: 20px;
            }
            
            .notes-section.active {
                display: block;
            }
            
            .notes-task-select {
                /* Base styles */
                width: 100%;
                padding: 12px 40px 12px 15px; /* Extra padding for arrow */
                background-color: var(--gray);
                border: 2px solid transparent;
                border-radius: var (--border-radius-md);
                color: white;
                font-family: inherit;
                font-size: 1rem;
                margin-bottom: 20px;
                cursor: pointer;
                
                /* Custom dropdown arrow */
                appearance: none;
                background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FF4444%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
                background-repeat: no-repeat;
                background-position: right 15px center;
                background-size: 12px auto;
                
                /* Transitions */
                transition: all 0.3s ease;
            }
            
            .notes-task-select:hover {
                background-color: var(--darker-bg);
                border-color: var(--lava-red);
            }
            
            .notes-task-select:focus {
                outline: none;
                border-color: var(--lava-red);
                box-shadow: 0 0 0 3px rgba(255, 68, 68, 0.2);
            }
            
            /* Style the options */
            .notes-task-select option {
                background-color: var(--darker-bg);
                color: white;
                padding: 12px;
            }
            
            .notes-list {
                display: grid;
                gap: 20px;
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
            
            .note-card {
                background-color: var(--gray);
                border-radius: var(--border-radius-md);
                padding: 20px;
                position: relative;
                transition: transform 0.2s, box-shadow 0.2s;
            }
            
            .note-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            }
            
            .note-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 10px;
            }
            
            .note-timestamp {
                font-size: 0.8em;
                color: var(--light-gray);
            }
            
            .note-content {
                min-height: 100px;
                padding: 10px;
                background-color: var (--darker-bg);
                border-radius: var(--border-radius-sm);
                margin: 10px 0;
                white-space: pre-wrap;
            }
            
            .note-actions {
                display: flex;
                gap: 10px;
                justify-content: flex-end;
            }
            
            .add-note-btn {
                width: 100%;
                padding: 15px;
                margin-bottom: 20px;
                background-color: var(--gray);
                border: 2px dashed var(--light-gray);
                border-radius: var(--border-radius-md);
                color: var(--light-gray);
                cursor: pointer;
                transition: all 0.3s;
            }
            
            .add-note-btn:hover {
                border-color: var(--lava-red);
                color: white;
                background-color: var(--lava-red);
            }
                        /* Add this CSS */
            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.5);
                z-index: 1000;
            }
            
            .modal-content {
                background-color: #fefefe;
                color:#0a0a0a;
                margin: 15% auto;
                padding: 20px;
                border-radius: 5px;
                width: 80%;
                max-width: 500px;
                text-align: center;
            }
            
            .modal-buttons {
                margin-top: 20px;
            }
            
            .modal-buttons button {
                margin: 0 10px;
                padding: 8px 20px;
            }

            /* Add this to your <style> section */
            /* Reports section styling */
            #reportsContent {
    padding: 30px;
    background: rgba(0, 0, 0, 0.7);
    border-radius: 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.summary-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

.summary-card {
        background: linear-gradient(145deg, var(--dark-bg), var(--darker-bg));
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        text-align: center;
        color: white;
    }

    .summary-card .icon {
        font-size: 24px;
        margin-bottom: 10px;
    }

    .summary-card .title {
        color: #888;
        font-size: 14px;
    }

    .summary-card .value {
        font-size: 24px;
        font-weight: 600;
        margin: 10px 0;
    }

    .summary-card .trend {
        font-size: 12px;
    }

    .charts-grid {
    display: grid;
    /* Increase minimum width */
    grid-template-columns: 1.5fr 0.9fr;

    gap: 20px;
}

.chart-container {
        background: rgba(71, 68, 68, 0.15);
        border-radius: 15px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.05),
                    0 4px 15px rgba(0, 0, 0, 0.15);
                    min-height: 300px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .chart-container:hover {
        transform: translateY(-3px);
        box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.05),
                    0 8px 20px rgba(0, 0, 0, 0.2);
    }

.reports-header {
    margin-bottom: 30px;
    color: rgba(255, 255, 255, 0.95);
    font-size: 24px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

/* Responsive adjustments */
@media (max-width: 800px) {
    #reportsContent .chart-container {
        max-width: 100%;
    }
}
/* Update the task-item class to use flex layout */
.task-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    /* ...existing styles... */
}

/* Style for the task-content class */
.task-content {
    display: flex;
    align-items: center;
}

/* Style the Discard button */
.discard-btn {
    background-color: var(--gray);
    border: none;
    color: white;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    cursor: pointer;
    font-size: 16px;
    line-height: 30px;
    text-align: center;
    padding: 0;
    transition: background-color 0.3s;
}

.discard-btn:hover {
    background-color: var(--lava-red);
}

/* Optional: Adjust the task-checkbox for better alignment */
.task-checkbox {
    margin-right: 10px;
    /* ...existing styles... */
}
/* Update the modal styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(10, 10, 10, 0.9); /* Dark semi-transparent background */
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background-color: var(--darker-bg);
    padding: 20px;
    border-radius: var(--border-radius-lg);
    width: 80%;
    max-width: 500px;
    color: white;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}

.modal-content h2 {
    margin-top: 0;
    text-align: center;
    margin-bottom: 20px;
}

.close-modal {
    background-color: var(--gray);
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: var(--border-radius-md);
    cursor: pointer;
    margin-top: 20px;
    transition: background-color 0.3s;
    width: 100%;
}

.close-modal:hover {
    background-color: var(--lava-red);
}

/* Style the discarded task list */
#discardedTaskList {
    list-style: none;
    padding: 0;
    max-height: 300px;
    overflow-y: auto;
}

#discardedTaskList li {
    background-color: var(--dark-bg);
    padding: 10px;
    margin-bottom: 10px;
    border-radius: var(--border-radius-md);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#discardedTaskList li span {
    flex: 1;
}

#discardedTaskList li button {
    background-color: var(--gray);
    border: none;
    color: white;
    padding: 5px 10px;
    border-radius: var(--border-radius-md);
    cursor: pointer;
    transition: background-color 0.3s;
    margin-left: 10px;
}

#discardedTaskList li button:hover {
    background-color: var(--lava-red);
}

/* Adjust scrollbar for the discarded task list */
#discardedTaskList::-webkit-scrollbar {
    width: 8px;
}

#discardedTaskList::-webkit-scrollbar-thumb {
    background-color: var(--gray);
    border-radius: var(--border-radius-md);
}
/* Add styles for completed tasks */
.task-item.completed {
    color: grey;
    text-decoration: line-through;
}
        </style>
    </head>
    <body>
        <div class="calendar-section">
            <h2 style="margin-bottom: 10px;">Calendar</h2>

            <div class="calendar">
                <div class="calendar-header">
                    <button id="prevMonth">&lt;</button>
                    <h3 id="currentMonth"></h3>
                    <button id="nextMonth">&gt;</button>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
            <div class="events-list">
                <h3 id="selectedDate" style="margin-bottom: 5px;">No date selected</h3>
                <div id="eventsList"></div>
            </div>
        </div>
    
        <div class="tasks-section">
            <div class="section-headers">
                <h2 class="section-header" id="tasksHeader">Tasks</h2>
                <h2 class="section-header inactive" id="goalsHeader">Goals</h2>
                <h2 class="section-header inactive" id="notesHeader">QuickNotes</h2>
                <h2 class="section-header inactive" id="reportsHeader">Reports</h2>
            </div>
            
            <div class="content-section active" id="tasksContent">
                <input type="text" class="task-input" id="taskInput" placeholder="Add a new task...">
                <ul class="task-list" id="taskList"></ul>
                <button id="openTimerSetup">Set Timer</button>
                <button id="trashButton">Trash</button>
            </div>

            <div class="content-section" id="goalsContent">
                <input type="text" class="task-input" id="goalInput" placeholder="Add a new goal...">
                <ul class="task-list" id="goalList"></ul>
            </div>

            <div class="content-section" id="notesContent">
                <select class="notes-task-select" id="notesTaskSelect">
                    <option value="" disabled selected>Select a task to view/add QuickNotes</option>
                </select>
                <button class="add-note-btn" id="addNoteBtn">+ New QuickNote</button>
                <div class="notes-list" id="notesList"></div>
            </div>

            <div class="content-section" id="reportsContent">
                <!-- <div class="chart-container">
                    <canvas id="dailyChart"></canvas>
                </div> -->
                <!-- <div class="chart-container">
                    <canvas id="weeklyChart"></canvas>
                </div> -->
                <!-- <div class="chart-container">
                    <canvas id="monthlyChart"></canvas>
                </div> -->
                <!-- <div class="chart-container">
                    <canvas id="taskCompletionChart"></canvas>
                </div> -->
                <!-- <div class="chart-container">
                    <canvas id="breakTimeChart"></canvas>
                </div> -->
            </div>
        </div>
    
        <div class="water-reminder" id="waterReminder">
            Time to drink water! ðŸ’§
        </div>
    
        <div class="overlay" id="overlay"></div>
        <div class="event-form" id="eventForm">
            <h3 style="margin-bottom: 10px;">Add Event</h3>
            <input type="text" id="eventTitle" placeholder="Event Title">
            <!-- Time Input using Timepicker -->
            <input type="text" id="eventTime" placeholder="Select Time">
            <textarea id="eventDescription" placeholder="Event Description" rows="3"></textarea>
            <div class="event-form-buttons">
                <button id="cancelEvent">Cancel</button>
                <button id="saveEvent">Save</button>
            </div>
        </div>

        <div class="overlay" id="timerOverlay"></div>
        <div class="timer-setup" id="timerSetup">
            <h3>Set Timer</h3>
            <input type="number" id="timerMinutes" placeholder="Minutes" min="0">
            <select id="taskSelect">
                <option value="" disabled selected>Select Task</option>
            </select>
            <div class="event-form-buttons">
                <button id="startTimer">Start</button>
                <button id="cancelTimer">Cancel</button>
            </div>
        </div>

                <!-- Inside the .fullscreen-timer div -->
        <div class="fullscreen-timer" id="fullscreenTimer">
            <div id="timerTaskName"></div>
            <div id="timerCountdown"></div>
            <div class="timer-controls">
                <button id="pauseResumeTimer">Pause</button>
                <button id="takeBreak">Take a Break</button>
                <button id="cancelBreak" style="display: none;">Cancel Break</button>
            </div>
            <button id="exitFullscreen">Exit Fullscreen</button>
        </div>

        <div id="trashModal" class="modal">
            <div class="modal-content">
                <h2>Discarded Tasks</h2>
                <ul id="discardedTaskList">
                    <!-- Discarded tasks will be rendered here -->
                </ul>
                <button id="closeTrash" class="close-modal">Close</button>
            </div>
        </div>

    <script>
                // Add these variables at the top of your script
        let timeTracking = JSON.parse(localStorage.getItem('timeTracking')) || [];

        function saveTimeTracking() {
            localStorage.setItem('timeTracking', JSON.stringify(timeTracking));
        }
        // Calendar functionality
        const calendarGrid = document.getElementById('calendarGrid');
        const currentMonthEl = document.getElementById('currentMonth');
        const selectedDateEl = document.getElementById('selectedDate');
        const eventsList = document.getElementById('eventsList');
        const eventForm = document.getElementById('eventForm');
        const overlay = document.getElementById('overlay');
        let currentDate = moment();
        let selectedDate = null;
        let events = JSON.parse(localStorage.getItem('events')) || {};

        function saveEvents() {
            localStorage.setItem('events', JSON.stringify(events));
        }

        function formatEventDate(date) {
            return moment(date).format('YYYY-MM-DD');
        }

        function renderCalendar() {
            calendarGrid.innerHTML = '';
            const firstDay = moment(currentDate).startOf('month');
            const lastDay = moment(currentDate).endOf('month');
            
            currentMonthEl.textContent = currentDate.format('MMMM YYYY');

            // Add day headers
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                const dayEl = document.createElement('div');
                dayEl.textContent = day;
                dayEl.style.fontWeight = 'bold';
                calendarGrid.appendChild(dayEl);
            });

            // Fill in empty days
            for (let i = 0; i < firstDay.day(); i++) {
                const emptyDay = document.createElement('div');
                calendarGrid.appendChild(emptyDay);
            }

            // Add month days
            // Update the calendar day creation in renderCalendar()
            for (let i = 1; i <= lastDay.date(); i++) {
    const dayEl = document.createElement('div');
    dayEl.className = 'calendar-day';
    
    // Check if this day is today
    const thisDate = moment(currentDate).date(i);
    if (thisDate.isSame(moment(), 'day')) {
        dayEl.classList.add('today');
    }
    
    const dateStr = formatEventDate(thisDate);
    if (events[dateStr] && events[dateStr].length > 0) {
        dayEl.classList.add('has-events');
    }
    
    if (selectedDate && i === moment(selectedDate).date() && 
        currentDate.month() === moment(selectedDate).month() &&
        currentDate.year() === moment(selectedDate).year()) {
        dayEl.classList.add('active');
    }

    const span = document.createElement('span');
    span.textContent = i;
    dayEl.appendChild(span);

    dayEl.addEventListener('click', () => {
        const clicked = moment(currentDate).date(i);
        selectedDate = clicked;
        updateSelectedDate();
        renderCalendar();
    });

    calendarGrid.appendChild(dayEl);
}}

        function updateSelectedDate() {
            if (selectedDate) {
                selectedDateEl.textContent = moment(selectedDate).format('MMMM D, YYYY');
                renderEvents();
            } else {
                selectedDateEl.textContent = 'No date selected';
                eventsList.innerHTML = '';
            }
        }

        function renderEvents() {
            const dateStr = formatEventDate(selectedDate);
            const dateEvents = events[dateStr] || [];
            
            eventsList.innerHTML = `
                <button onclick="showEventForm()">Add Event</button>
                ${dateEvents.sort((a, b) => a.time.localeCompare(b.time)).map(event => `
                    <div class="event-item">
                        <button class="delete-event" onclick="deleteEvent('${dateStr}', '${event.id}')">Ã—</button>
                        <div class="event-time">${event.time}</div>
                        <div class="event-title">${event.title}</div>
                        <div class="event-description">${event.description}</div>
                    </div>
                `).join('')}
            `;
        }

        function showEventForm() {
            eventForm.classList.add('active');
            overlay.classList.add('active');
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventDescription').value = '';
        }

        function hideEventForm() {
            eventForm.classList.remove('active');
            overlay.classList.remove('active');
        }

        function addEvent() {
            const title = document.getElementById('eventTitle').value.trim();
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value.trim();
            
            if (!title || !time) return;

            const dateStr = formatEventDate(selectedDate);
            if (!events[dateStr]) {
                events[dateStr] = [];
            }

            events[dateStr].push({
                id: Date.now().toString(),
                title,
                time,
                description
            });

            saveEvents();
            hideEventForm();
            renderEvents();
            renderCalendar();
        }

        function deleteEvent(dateStr, eventId) {
            events[dateStr] = events[dateStr].filter(event => event.id !== eventId);
            if (events[dateStr].length === 0) {
                delete events[dateStr];
            }
            saveEvents();
            renderEvents();
            renderCalendar();
        }

        document.getElementById('prevMonth').addEventListener('click', () => {
            currentDate = moment(currentDate).subtract(1, 'month');
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentDate = moment(currentDate).add(1, 'month');
            renderCalendar();
        });

        document.getElementById('saveEvent').addEventListener('click', addEvent);
        document.getElementById('cancelEvent').addEventListener('click', hideEventForm);
        overlay.addEventListener('click', hideEventForm);

        // Tasks functionality
        const taskInput = document.getElementById('taskInput');
        const taskList = document.getElementById('taskList');
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let discardedTasks = JSON.parse(localStorage.getItem('discardedTasks')) || [];

        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }

        function saveDiscardedTasks() {
            localStorage.setItem('discardedTasks', JSON.stringify(discardedTasks));
        }

        function renderTasks() {
    taskList.innerHTML = '';
    tasks.forEach((task, index) => {
        const li = document.createElement('li');
        li.className = 'task-item';

        // Add 'completed' class if the task is completed
        if (task.completed) {
            li.classList.add('completed');
        }

        // Create a container for the checkbox and label
        const taskContent = document.createElement('div');
        taskContent.className = 'task-content';

        // Create the checkbox
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = task.completed;
        checkbox.className = 'task-checkbox';
        checkbox.addEventListener('change', () => {
            task.completed = checkbox.checked;
            saveTasks();
            renderTasks();
        });

        // Create the label
        const label = document.createElement('span');
        label.textContent = task.text;

        taskContent.appendChild(checkbox);
        taskContent.appendChild(label);

        // Create the Discard button
        const discardBtn = document.createElement('button');
        discardBtn.textContent = 'âœ•'; // Use an "X" symbol or any icon
        discardBtn.className = 'discard-btn';
        discardBtn.addEventListener('click', () => discardTask(index));

        // Append the content and discard button to the list item
        li.appendChild(taskContent);
        li.appendChild(discardBtn);

        taskList.appendChild(li);
    });
}

        function discardTask(index) {
            const discardedTask = tasks.splice(index, 1)[0];
            discardedTask.discardedAt = Date.now();
            discardedTasks.push(discardedTask);
            saveTasks();
            saveDiscardedTasks();
            renderTasks();
        }

        function renderDiscardedTasks() {
    const discardedTaskList = document.getElementById('discardedTaskList');
    discardedTaskList.innerHTML = '';
    discardedTasks.forEach((task, index) => {
        const li = document.createElement('li');

        const taskText = document.createElement('span');
        taskText.textContent = task.text;

        // Restore button
        const restoreBtn = document.createElement('button');
        restoreBtn.textContent = 'Restore';
        restoreBtn.addEventListener('click', () => restoreTask(index));

        // Optionally, add a permanent delete button
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Delete';
        deleteBtn.addEventListener('click', () => deleteDiscardedTask(index));

        li.appendChild(taskText);
        li.appendChild(restoreBtn);
        li.appendChild(deleteBtn);

        discardedTaskList.appendChild(li);
    });
}

/* Function to delete a discarded task permanently */
function deleteDiscardedTask(index) {
    discardedTasks.splice(index, 1);
    saveDiscardedTasks();
    renderDiscardedTasks();
}

        function restoreTask(index) {
            const restoredTask = discardedTasks.splice(index, 1)[0];
            delete restoredTask.discardedAt;
            tasks.push(restoredTask);
            saveTasks();
            saveDiscardedTasks();
            renderTasks();
            renderDiscardedTasks();
        }

        // Load discarded tasks from localStorage
        if (localStorage.getItem('discardedTasks')) {
            discardedTasks = JSON.parse(localStorage.getItem('discardedTasks'));
            // Remove tasks older than a week
            const oneWeekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
            discardedTasks = discardedTasks.filter(task => task.discardedAt > oneWeekAgo);
            saveDiscardedTasks();
        }

        // Add event listener for the Trash button
        document.getElementById('trashButton').addEventListener('click', () => {
            renderDiscardedTasks();
            document.getElementById('trashModal').style.display = 'block';
        });

        // Close the Trash modal
        document.getElementById('closeTrash').addEventListener('click', () => {
            document.getElementById('trashModal').style.display = 'none';
        });

        taskInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && taskInput.value.trim()) {
                tasks.push({
                    text: taskInput.value.trim(),
                    completed: false
                });
                taskInput.value = '';
                saveTasks();
                renderTasks();
            }
        });

// Water reminder functionality
const waterReminder = document.getElementById('waterReminder');

function showWaterReminder() {
    waterReminder.style.display = 'block';
    setTimeout(() => {
        waterReminder.style.display = 'none';
    }, 5000);
}

setInterval(showWaterReminder, 1200000); // 20 minutes

// Initial renders
renderCalendar();
renderTasks();
const goalsHeader = document.getElementById('goalsHeader');
            const tasksHeader = document.getElementById('tasksHeader');
            const goalsContent = document.getElementById('goalsContent');
            const tasksContent = document.getElementById('tasksContent');
            const goalInput = document.getElementById('goalInput');
            const goalList = document.getElementById('goalList');
            
            let goals = JSON.parse(localStorage.getItem('goals')) || [];

            function saveGoals() {
                localStorage.setItem('goals', JSON.stringify(goals));
            }

            // Update the sections object in switchSection function
            function switchSection(section) {
                const sections = {
                    tasks: { header: tasksHeader, content: tasksContent },
                    goals: { header: goalsHeader, content: goalsContent },
                    notes: { header: notesHeader, content: notesContent },
                    reports: { header: reportsHeader, content: reportsContent }
                };

                Object.keys(sections).forEach(key => {
                    const { header, content } = sections[key];
                    if (key === section) {
                        header.classList.remove('inactive');
                        content.classList.add('active');
                    } else {
                        header.classList.add('inactive');
                        content.classList.remove('active');
                    }
                });
            }

            // Add event listener for Reports header
            reportsHeader.addEventListener('click', () => {
                switchSection('reports');
                renderReports();
            });

            function renderGoals() {
                goalList.innerHTML = '';
                goals.forEach((goal, index) => {
                    const li = document.createElement('li');
                    li.className = 'goal-item';
                    li.innerHTML = `
                        <span>${goal.text}</span>
                        <div class="goal-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${goal.progress}%"></div>
                            </div>
                            <span class="progress-text">${goal.progress}%</span>
                            <button onclick="updateProgress(${index})">Update</button>
                        </div>
                    `;
                    goalList.appendChild(li);
                });
            }

            function updateProgress(index) {
                const newProgress = prompt('Enter new progress (0-100):', goals[index].progress);
                if (newProgress !== null && !isNaN(newProgress)) {
                    const progress = Math.min(100, Math.max(0, parseInt(newProgress)));
                    goals[index].progress = progress;
                    saveGoals();
                    renderGoals();
                }
            }

            goalInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && goalInput.value.trim()) {
                    goals.push({
                        text: goalInput.value.trim(),
                        progress: 0
                    });
                    goalInput.value = '';
                    saveGoals();
                    renderGoals();
                }
            });

            goalsHeader.addEventListener('click', () => switchSection('goals'));
            tasksHeader.addEventListener('click', () => switchSection('tasks'));

            // Initial render for goals
            renderGoals();
// Timer Elements
const openTimerSetup = document.getElementById('openTimerSetup');
const timerOverlay = document.getElementById('timerOverlay');
const timerSetup = document.getElementById('timerSetup');
const timerMinutes = document.getElementById('timerMinutes');
const taskSelect = document.getElementById('taskSelect');
const startTimer = document.getElementById('startTimer');
const cancelTimer = document.getElementById('cancelTimer');
const fullscreenTimer = document.getElementById('fullscreenTimer');
const timerTaskName = document.getElementById('timerTaskName');
const timerCountdown = document.getElementById('timerCountdown');
const exitFullscreen = document.getElementById('exitFullscreen');
const pauseResumeTimer = document.getElementById('pauseResumeTimer');
const takeBreak = document.getElementById('takeBreak');
const cancelBreak = document.getElementById('cancelBreak');

let countdownInterval;
let isPaused = false;
let totalTimeInSeconds = 0;
let isOnBreak = false;
let taskName = '';
let timerStartTime;
let pausedDuration = 0;
let pauseStartTime;
let breakStartTime;
let breakTime = 0;

// Populate task dropdown
function populateTaskSelect() {
    taskSelect.innerHTML = '<option value="" disabled selected>Select Task</option>';
    tasks.forEach(task => {
        const option = document.createElement('option');
        option.value = task.text;
        option.textContent = task.text;
        taskSelect.appendChild(option);
    });
}

// Open timer setup modal
openTimerSetup.addEventListener('click', () => {
    populateTaskSelect();
    timerOverlay.classList.add('active');
    timerSetup.style.display = 'block';
});

// Close timer setup modal
cancelTimer.addEventListener('click', () => {
    timerOverlay.classList.remove('active');
    timerSetup.style.display = 'none';
    timerMinutes.value = '';
    taskSelect.value = '';
});

// Start the timer
startTimer.addEventListener('click', () => {
    const minutes = parseInt(timerMinutes.value);
    const selectedTask = taskSelect.value;

    if (!isNaN(minutes) && selectedTask) {
        timerOverlay.classList.remove('active');
        timerSetup.style.display = 'none';
        startCountdown(minutes, selectedTask);
    }
});
document.addEventListener('DOMContentLoaded', () => {
    // Ensure fullscreen timer is hidden on page load
    const fullscreenTimer = document.getElementById('fullscreenTimer');
    fullscreenTimer.style.display = 'none';
    
    // Other initialization code...
});
// Modify startCountdown function
// Inside startCountdown function, store the start time
function startCountdown(minutes, task) {
    totalTimeInSeconds = minutes * 60;
    taskName = task;
    timerStartTime = new Date().getTime();
    pausedDuration = 0;
    isPaused = false;
    isOnBreak = false;

    timerTaskName.textContent = `Task: ${taskName}`;
    fullscreenTimer.style.display = 'flex';

    updateCountdownDisplay(totalTimeInSeconds);

    countdownInterval = setInterval(mainTimerFunction, 1000);
}

function mainTimerFunction() {
    if (!isPaused) {
        let currentTime = new Date().getTime();
        let elapsedTime = Math.floor((currentTime - timerStartTime - pausedDuration) / 1000);
        let remainingTime = totalTimeInSeconds - elapsedTime;
        updateCountdownDisplay(remainingTime);

        if (remainingTime <= 0) {
            clearInterval(countdownInterval);
            recordTime(taskName, (new Date() - timerStartTime) / 1000, 'task');
            alert("Time's up!");
            fullscreenTimer.style.display = 'none';
        }
    }
}

// Update the updateCountdownDisplay function
function updateCountdownDisplay(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    timerCountdown.textContent = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
}

// Event listener for Pause/Resume button
pauseResumeTimer.addEventListener('click', () => {
    if (isPaused) {
        isPaused = false;
        pausedDuration += new Date().getTime() - pauseStartTime;
        pauseResumeTimer.textContent = 'Pause';
    } else {
        isPaused = true;
        pauseStartTime = new Date().getTime();
        pauseResumeTimer.textContent = 'Resume';
    }
});


// Modify takeBreak event listener
takeBreak.addEventListener('click', () => {
    if (isOnBreak) return;

    isPaused = true;
    pauseResumeTimer.textContent = 'Resume';

    const breakDuration = prompt('Select break duration in minutes (5 or 10):', '5');
    const breakMinutes = parseInt(breakDuration);

    if (!isNaN(breakMinutes) && (breakMinutes === 5 || breakMinutes === 10)) {
        isOnBreak = true;
        startBreakCountdown(breakMinutes);
    } else {
        isPaused = false;
        pauseResumeTimer.textContent = 'Pause';
    }
});

function endBreak() {
    clearInterval(countdownInterval);
    recordTime('Break', (new Date() - breakStartTime) / 1000, 'break');
    alert("Break is over!");

    timerTaskName.textContent = `Task: ${taskName}`;
    isPaused = false;
    pauseResumeTimer.textContent = 'Pause';
    isOnBreak = false;

    cancelBreak.style.display = 'none';

    updateCountdownDisplay(totalTimeInSeconds);
    countdownInterval = setInterval(mainTimerFunction, 1000);
}
// When user exits the fullscreen timer
exitFullscreen.addEventListener('click', () => {
    clearInterval(countdownInterval);
    if (!isOnBreak && timerStartTime) {
        recordTime(taskName, (new Date() - timerStartTime) / 1000, 'task');
    } else if (isOnBreak && breakStartTime) {
        recordTime('Break', (new Date() - breakStartTime) / 1000, 'break');
    }
    fullscreenTimer.style.display = 'none';
});

$(document).ready(function(){
            $('#eventTime').timepicker({
                timeFormat: 'h:mm p', // Customize time format as needed
                // Additional options for customization (interval, min/max time, etc.)
            });
        });

// Get the cancel break button element

cancelBreak.addEventListener('click', () => {
    if (!isOnBreak) return;

    clearInterval(countdownInterval);
    recordTime('Break', (new Date() - breakStartTime) / 1000);

    timerTaskName.textContent = `Task: ${taskName}`;
    isPaused = false;
    pauseResumeTimer.textContent = 'Pause';
    isOnBreak = false;

    cancelBreak.style.display = 'none';

    updateCountdownDisplay(totalTimeInSeconds);
    countdownInterval = setInterval(mainTimerFunction, 1000);
});

function recordTime(task, durationInSeconds, type) {
    timeTracking.push({
        task: task,
        duration: durationInSeconds,
        type: type,
        timestamp: new Date().toISOString()
    });
    saveTimeTracking();
}

// Modify startBreakCountdown function
function startBreakCountdown(minutes) {
    let breakTime = minutes * 60;
    clearInterval(countdownInterval);

    // Show Cancel Break button
    cancelBreak.style.display = 'inline-block';

    // Update UI to show break timer
    timerTaskName.textContent = `Break Time`;
    updateCountdownDisplay(breakTime);

    countdownInterval = setInterval(() => {
        breakTime--;
        updateCountdownDisplay(breakTime);

        if (breakTime <= 0) {
            clearInterval(countdownInterval);
            alert("Break is over!");

            // Resume main timer
            timerTaskName.textContent = `Task: ${taskName}`;
            isPaused = false;
            pauseResumeTimer.textContent = 'Pause';
            isOnBreak = false;

            // Hide Cancel Break button
            cancelBreak.style.display = 'none';

            updateCountdownDisplay(totalTimeInSeconds);
            countdownInterval = setInterval(mainTimerFunction, 1000);
        }
    }, 1000);
}

function renderReports() {
    // Clear existing content
    const reportsContent = document.getElementById('reportsContent');
    reportsContent.innerHTML = '';

    // Add summary cards section
    const summarySection = createSummarySection();
    reportsContent.appendChild(summarySection);

    // Add enhanced charts section with improved layout
    const chartsGrid = document.createElement('div');
    chartsGrid.className = 'charts-grid';
    reportsContent.appendChild(chartsGrid);

    // Render enhanced charts
    renderProductivityChart(chartsGrid);
    renderTaskBreakdownChart(chartsGrid);
    renderWeeklyTrendsChart(chartsGrid);
    renderBreakAnalysisChart(chartsGrid);

    // Render doughnut charts for day, week, and month
    // renderChart('day', 'dailyChart', 'Daily Task Distribution');
    // renderChart('week', 'weeklyChart', 'Weekly Task Distribution');
    // renderChart('month', 'monthlyChart', 'Monthly Task Distribution');
}

function renderTaskCompletionChart() {
    const completedTasks = tasks.filter(task => task.completed).length;
    const pendingTasks = tasks.length - completedTasks;

    const ctx = document.getElementById('taskCompletionChart').getContext('2d');
    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Completed', 'Pending'],
            datasets: [{
                data: [completedTasks, pendingTasks],
                backgroundColor: ['#00C851', '#ff4444'],
                borderWidth: 2,
                borderColor: '#1a1a1a',
            }]
        },
        options: {
            plugins: {
                legend: { position: 'bottom', labels: { color: '#ffffff' } },
                title: { display: true, text: 'Task Completion Status', color: '#ffffff' },
            }
        }
    });
}

function renderBreakTimeChart() {
    const breaks = timeTracking.filter(entry => entry.type === 'break');
    const totalBreakTime = breaks.reduce((sum, entry) => sum + entry.duration, 0) / 60; // Convert to minutes

    const ctx = document.getElementById('breakTimeChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Total Break Time (mins)'],
            datasets: [{
                data: [totalBreakTime],
                backgroundColor: ['#ffbb33'],
            }]
        },
        options: {
            plugins: {
                legend: { display: false },
                title: { display: true, text: 'Break Time', color: '#ffffff' },
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#ffffff' },
                },
                x: {
                    ticks: { color: '#ffffff' },
                },
            }
        }
    });
}

function generateColors(numColors) {
    const colors = [
        '#ff4444', '#ffbb33', '#00C851', '#33b5e5',
        '#2BBBAD', '#4285F4', '#aa66cc', '#ff4444',
        '#FF8800', '#007E33', '#0099CC', '#9933CC'
    ];
    return colors.slice(0, numColors);
}

function renderChart(period, canvasId, chartTitle) {
    const now = moment();
    let startOfPeriod;
    if (period === 'day') {
        startOfPeriod = now.clone().startOf('day');
    } else if (period === 'week') {
        startOfPeriod = now.clone().startOf('week');
    } else if (period === 'month') {
        startOfPeriod = now.clone().startOf('month');
    }

    const periodData = timeTracking.filter(entry => {
        return moment(entry.timestamp).isSameOrAfter(startOfPeriod);
    });

    const taskTimes = {};
    periodData.forEach(entry => {
        const task = entry.task;
        if (!taskTimes[task]) {
            taskTimes[task] = 0;
        }
        taskTimes[task] += entry.duration;
    });

    const labels = Object.keys(taskTimes);
    const data = labels.map(task => taskTimes[task] / 60); // Convert seconds to minutes

    if (window[canvasId + 'Chart']) {
        window[canvasId + 'Chart'].destroy();
    }

    const ctx = document.getElementById(canvasId).getContext('2d');
    window[canvasId + 'Chart'] = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: generateColors(labels.length),
                borderWidth: 2,
                borderColor: '#1a1a1a',
                hoverBorderColor: '#ffffff',
            }]
        },
        options: {
            responsive: true,
            cutout: '60%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#ffffff',
                        font: {
                            size: 14,
                        },
                    },
                },
                title: {
                    display: true,
                    text: chartTitle,
                    color: '#ffffff',
                    font: {
                        size: 20,
                    },
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.raw;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((value / total) * 100).toFixed(1) + '%';
                            return `${label}: ${value.toFixed(1)} mins (${percentage})`;
                        }
                    }
                },
                datalabels: {
                    color: '#ffffff',
                    textAlign: 'center',
                    font: {
                        weight: 'bold',
                        size: 14,
                    },
                    formatter: function(value, context) {
                        const total = context.chart._metasets[context.datasetIndex].total;
                        const percentage = (value / total * 100).toFixed(1) + '%';
                        return percentage;
                    }
                }
            }
        },
        plugins: [ChartDataLabels],
    });
}

function generateColors(numColors) {
    const colors = [];
    for (let i = 0; i < numColors; i++) {
        colors.push(`hsl(${(i * 360 / numColors)}, 70%, 50%)`);
    }
    return colors;
}


// Initialize by hiding the Cancel Break button
cancelBreak.style.display = 'none';
// Notes functionality
const notesHeader = document.getElementById('notesHeader');
const notesContent = document.getElementById('notesContent');
const notesTaskSelect = document.getElementById('notesTaskSelect');
const notesList = document.getElementById('notesList');
const addNoteBtn = document.getElementById('addNoteBtn');

let notes = JSON.parse(localStorage.getItem('notes')) || {};

function saveNotes() {
    localStorage.setItem('notes', JSON.stringify(notes));
}

function updateNotesTaskSelect() {
    notesTaskSelect.innerHTML = `
        <option value="" disabled selected>Select a task to view/add QuickNote</option>
        <option value="all">All Notes</option>
    `;
    tasks.forEach(task => {
        const option = document.createElement('option');
        option.value = task.text;  
        option.textContent = task.text;
        notesTaskSelect.appendChild(option);
    });
}

function formatTimestamp(timestamp) {
    return moment(timestamp).format('MMM D, YYYY [at] h:mm A');
}

function renderNotes(taskName) {
    if (!taskName) {
        notesList.innerHTML = '';
        return;
    }

    if (taskName === 'all') {
        // Render all notes grouped by task
        const allNotes = Object.entries(notes).map(([task, taskNotes]) => {
            return taskNotes.map(note => ({...note, taskName: task}));
        }).flat();

        // Sort by timestamp descending
        allNotes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        notesList.innerHTML = allNotes.map(note => `
            <div class="note-card">
                <div class="note-header">
                    <div>
                        <div class="note-task">${note.taskName}</div>
                        <div class="note-timestamp">Last edited: ${formatTimestamp(note.timestamp)}</div>
                    </div>
                    <button class="delete-event" onclick="deleteNote('${note.taskName}', '${note.id}')">Ã—</button>
                </div>
                <div class="note-content" contenteditable="true" onblur="updateNote('${note.taskName}', '${note.id}', this.textContent)">${note.content}</div>
            </div>
        `).join('');

        // Hide add note button in "all" view
        addNoteBtn.style.display = 'none';
        return;
    }

    // Show add note button for specific task view
    addNoteBtn.style.display = 'block';

    // Original single task notes rendering
    const taskNotes = notes[taskName] || [];
    notesList.innerHTML = taskNotes.map(note => `
        <div class="note-card">
            <div class="note-header">
                <div class="note-timestamp">Last edited: ${formatTimestamp(note.timestamp)}</div>
                <button class="delete-event" onclick="deleteNote('${taskName}', '${note.id}')">Ã—</button>
            </div>
            <div class="note-content" contenteditable="true" onblur="updateNote('${taskName}', '${note.id}', this.textContent)">${note.content}</div>
        </div>
    `).join('');
}

const style = document.createElement('style');
style.textContent = `
    .note-task {
        color: var(--lava-red);
        font-size: 0.9em;
        font-weight: 500;
        margin-bottom: 4px;
    }
`;
document.head.appendChild(style);

function addNote(taskName) {
    if (!taskName) return;
    
    if (!notes[taskName]) {
        notes[taskName] = [];
    }

    const newNote = {
        id: Date.now().toString(),
        content: 'Click to edit note...',
        timestamp: new Date().toISOString()
    };

    notes[taskName].unshift(newNote);
    saveNotes();
    renderNotes(taskName);
}

function updateNote(taskName, noteId, content) {
    const noteIndex = notes[taskName].findIndex(note => note.id === noteId);
    if (noteIndex !== -1) {
        notes[taskName][noteIndex].content = content;
        notes[taskName][noteIndex].timestamp = new Date().toISOString();
        saveNotes();
        renderNotes(taskName);
    }
}

// Replace the existing deleteNote function with this
function deleteNote(taskName, noteId) {
    const modal = document.getElementById('deleteModal');
    const confirmBtn = document.getElementById('confirmDelete');
    const cancelBtn = document.getElementById('cancelDelete');

    modal.style.display = 'block';

    const handleDelete = () => {
        notes[taskName] = notes[taskName].filter(note => note.id !== noteId);
        if (notes[taskName].length === 0) {
            delete notes[taskName];
        }
        saveNotes();
        renderNotes(taskName);
        modal.style.display = 'none';
        cleanup();
    };

    const handleCancel = () => {
        modal.style.display = 'none';
        cleanup();
    };

    const cleanup = () => {
        confirmBtn.removeEventListener('click', handleDelete);
        cancelBtn.removeEventListener('click', handleCancel);
    };

    confirmBtn.addEventListener('click', handleDelete);
    cancelBtn.addEventListener('click', handleCancel);
}

notesHeader.addEventListener('click', () => {
    switchSection('notes');
    updateNotesTaskSelect();
});

notesTaskSelect.addEventListener('change', (e) => {
    renderNotes(e.target.value);
});

addNoteBtn.addEventListener('click', () => {
    addNote(notesTaskSelect.value);
});

function calculateStats() {
    // Calculate completion rate
    const completedTasks = tasks.filter(t => t.completed).length;
    const totalTasks = tasks.length;
    const completionRate = Math.round((completedTasks / totalTasks) * 100) || 0;

    // Calculate average time per task
    const taskTimes = timeTracking.filter(t => t.type === 'task');
    const avgTimeMin = Math.round(taskTimes.reduce((acc, t) => acc + t.duration, 0) / (taskTimes.length || 1) / 60) || 0;

    // Calculate break efficiency
    const totalBreakTime = timeTracking.filter(t => t.type === 'break')
        .reduce((acc, t) => acc + t.duration, 0);
    const totalWorkTime = timeTracking.filter(t => t.type === 'task')
        .reduce((acc, t) => acc + t.duration, 0);
    const breakRatio = totalWorkTime ? (totalBreakTime / totalWorkTime) : 0;
    const breakEfficiency = Math.round(
        breakRatio >= 0.15 && breakRatio <= 0.25 ? 100 : 
        breakRatio < 0.15 ? (breakRatio / 0.15) * 100 : 
        ((0.25 - (breakRatio - 0.25)) / 0.25) * 100
    ) || 0;

    // Calculate trends by comparing with last week
    const currentWeekData = getWeekData(0);
    const lastWeekData = getWeekData(1);
    
    const completionTrend = calculateTrend(
        currentWeekData.completedTasks, 
        lastWeekData.completedTasks
    );
    
    const timeTrend = calculateTimeTrend(
        currentWeekData.avgTaskTime, 
        lastWeekData.avgTaskTime
    );
    
    const breakTrend = calculateTrend(
        currentWeekData.breakEfficiency,
        lastWeekData.breakEfficiency
    );

    // Calculate productivity score (A-F scale)
    const productivityScore = calculateProductivityGrade(
        completionRate,
        breakEfficiency,
        currentWeekData.taskCount
    );

    const productivityTrend = calculateTrend(
        currentWeekData.productivityScore,
        lastWeekData.productivityScore
    );

    return {
        completionRate,
        avgTimePerTask: avgTimeMin,
        breakEfficiency,
        productivityScore,
        completionTrend,
        timeTrend,
        breakTrend,
        productivityTrend
    };
}

function getWeekData(weeksAgo) {
    const startDate = moment().subtract(weeksAgo, 'weeks').startOf('week');
    const endDate = moment().subtract(weeksAgo, 'weeks').endOf('week');
    
    const weekTasks = tasks.filter(task => {
        if (!task.completedAt) return false;
        const completedDate = moment(task.completedAt);
        return completedDate.isBetween(startDate, endDate, 'day', '[]');
    });

    const weekTimeTracking = timeTracking.filter(entry =>
        moment(entry.timestamp).isBetween(startDate, endDate, 'day', '[]')
    );

    const taskTimes = weekTimeTracking.filter(t => t.type === 'task');
    const breakTimes = weekTimeTracking.filter(t => t.type === 'break');

    const totalTaskTime = taskTimes.reduce((acc, t) => acc + t.duration, 0);
    const totalBreakTime = breakTimes.reduce((acc, t) => acc + t.duration, 0);
    const breakRatio = totalTaskTime ? (totalBreakTime / totalTaskTime) : 0;

    return {
        completedTasks: weekTasks.length,
        taskCount: taskTimes.length,
        avgTaskTime: taskTimes.length ? totalTaskTime / taskTimes.length / 60 : 0,
        breakEfficiency: Math.round(
            breakRatio >= 0.15 && breakRatio <= 0.25 ? 100 : 
            breakRatio < 0.15 ? (breakRatio / 0.15) * 100 : 
            ((0.25 - (breakRatio - 0.25)) / 0.25) * 100
        ),
        productivityScore: calculateProductivityScore(weekTimeTracking)
    };
}

function calculateTrend(current, previous) {
    if (!previous) return '+0%';
    const change = ((current - previous) / previous) * 100;
    return `${change > 0 ? '+' : ''}${change.toFixed(1)}%`;
}

function calculateTimeTrend(current, previous) {
    if (!previous) return '+0min';
    const change = current - previous;
    return `${change > 0 ? '+' : ''}${Math.round(change)}min`;
}

function calculateProductivityGrade(completionRate, breakEfficiency, taskCount) {
    const score = (completionRate * 0.4) + (breakEfficiency * 0.4) + (Math.min(taskCount * 10, 20));
    
    if (score >= 90) return 'A';
    if (score >= 80) return 'B';
    if (score >= 70) return 'C';
    if (score >= 60) return 'D';
    return 'F';
}

function createStatsCard(parent, data) {
        const card = document.createElement('div');
        card.className = 'summary-card';

        card.innerHTML = `
            <div class="icon">${data.icon}</div>
            <div class="title">${data.title}</div>
            <div class="value">${data.value}</div>
            <div class="trend" style="color: ${data.trend.includes('+') ? '#00C851' : '#ff4444'};">
                ${data.trend} from last week
            </div>
        `;

        parent.appendChild(card);
    }

// Enhanced chart rendering functions with better visuals
function renderProductivityChart(parent) {
    const container = createChartContainer(parent, 'productivityChart');
    const ctx = container.querySelector('canvas').getContext('2d');
    
    // Get last 7 days of data
    const dailyData = getProductivityData(7);

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: dailyData.labels,
            datasets: [{
                label: 'Productivity Score',
                data: dailyData.scores,
                borderColor: '#00C851',
                backgroundColor: 'rgba(0, 200, 81, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 2, // Makes the chart wider (default is 2:1)
            plugins: {
                title: {
                    display: true,
                    text: 'Daily Productivity Trend',
                    color: '#ffffff',
                    font: { size: 16 }
                },
                legend: {
                    labels: { color: '#ffffff' }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#ffffff' }
                },
                x: {
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#ffffff' }
                }
            }
        }
    });
}

function createSummarySection() {
        const section = document.createElement('div');
        section.className = 'summary-section';

        const stats = calculateStats();
        const cards = [
            {
                title: 'Task Completion Rate',
                value: `${stats.completionRate}%`,
                trend: stats.completionTrend,
                icon: 'ðŸ“ˆ'
            },
            {
                title: 'Avg. Time per Task',
                value: `${stats.avgTimePerTask} min`,
                trend: stats.timeTrend,
                icon: 'â±ï¸'
            },
            {
                title: 'Break Efficiency',
                value: `${stats.breakEfficiency}%`,
                trend: stats.breakTrend,
                icon: 'ðŸŽ¯'
            },
            {
                title: 'Productivity Score',
                value: stats.productivityScore,
                trend: stats.productivityTrend,
                icon: 'â­'
            }
        ];

        cards.forEach(card => createStatsCard(section, card));
        return section;
    }


function renderProductivityChart(parent) {
    const container = createChartContainer(parent, 'productivityChart');
    const ctx = container.querySelector('canvas').getContext('2d');
    
    // Get last 7 days of data
    const dailyData = getProductivityData(7);

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: dailyData.labels,
            datasets: [{
                label: 'Productivity Score',
                data: dailyData.scores,
                borderColor: '#00C851',
                backgroundColor: 'rgba(0, 200, 81, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Daily Productivity Trend',
                    color: '#ffffff',
                    font: { size: 16 }
                },
                legend: {
                    labels: { color: '#ffffff' }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#ffffff' }
                },
                x: {
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    ticks: { color: '#ffffff' }
                }
            }
        }
    });
}

function renderTaskBreakdownChart(parent) {
    const container = createChartContainer(parent, 'taskBreakdownChart');
    const ctx = container.querySelector('canvas').getContext('2d');
    const taskData = getTaskBreakdownData();

    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: taskData.labels,
            datasets: [{
                data: taskData.times,
                backgroundColor: generateColors(taskData.labels.length, 0.85),
                borderWidth: 2,
                borderColor: '#1a1a1a',
                hoverBorderWidth: 3,
                hoverBorderColor: '#ffffff',
                hoverOffset: 10
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: {
                padding: 20
            },
            cutout: '60%',
            plugins: {
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.9)',
                    padding: 12,
                    titleFont: {
                        size: 14,
                        family: "'Inter', sans-serif",
                        weight: 'bold'
                    },
                    bodyFont: {
                        size: 13,
                        family: "'Inter', sans-serif"
                    },
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.raw || 0;
                            const hours = Math.floor(value);
                            const minutes = Math.round((value - hours) * 60);
                            const percentage = ((value / context.dataset.data.reduce((a, b) => a + b, 0)) * 100).toFixed(1);
                            return `${label}: ${hours}h ${minutes}m (${percentage}%)`;
                        }
                    }
                },
                datalabels: {
                    color: '#ffffff',
                    textShadow: '2px 2px 2px rgba(0, 0, 0, 0.7)',
                    font: {
                        weight: 'bold',
                        size: 14
                    },
                    formatter: (value, ctx) => {
                        const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                        const percentage = ((value / total) * 100).toFixed(1);
                        return percentage + '%';
                    },
                    anchor: 'center',
                    offset: 0,
                    align: 'center',
                    backgroundColor: 'rgba(0, 0, 0, 0.6)',
                    borderRadius: 4,
                    padding: 4
                },
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#ffffff',
                        padding: 15,
                        font: {
                            size: 12,
                            family: "'Inter', sans-serif"
                        },
                        usePointStyle: true,
                        pointStyle: 'circle'
                    }
                },
                title: {
                    display: true,
                    text: 'Task Time Distribution',
                    color: '#ffffff',
                    font: {
                        size: 18,
                        weight: 'bold',
                        family: "'Inter', sans-serif"
                    },
                    padding: 20
                }
            },
            animation: {
                animateScale: true,
                animateRotate: true,
                duration: 800
            }
        },
        plugins: [ChartDataLabels]
    });

    ctx.canvas.style.width = '400px';
    ctx.canvas.style.height = '400px';
}


    function renderWeeklyTrendsChart(parent) {
        const container = createChartContainer(parent, 'weeklyTrendsChart');
        const ctx = container.querySelector('canvas').getContext('2d');
        
        const weeklyData = getWeeklyTrendsData();

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: weeklyData.days,
                datasets: [{
                    label: 'Tasks Completed',
                    data: weeklyData.completed,
                    backgroundColor: '#4285F4',
                    borderRadius: 5
                }, {
                    label: 'Time Spent (hrs)',
                    data: weeklyData.timeSpent,
                    backgroundColor: '#ffbb33',
                    borderRadius: 5
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Weekly Activity Overview',
                        color: '#ffffff',
                        font: { size: 16 }
                    },
                    legend: {
                        labels: { color: '#ffffff' }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#ffffff' }
                    },
                    x: {
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#ffffff' }
                    }
                }
            }
        });
    }

    function renderBreakAnalysisChart(parent) {
        const container = createChartContainer(parent, 'breakAnalysisChart');
        const ctx = container.querySelector('canvas').getContext('2d');
        
        const breakData = getBreakAnalysisData();

        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: breakData.timeSlots,
                datasets: [{
                    label: 'Break Distribution',
                    data: breakData.counts,
                    backgroundColor: 'rgba(255, 68, 68, 0.2)',
                    borderColor: '#ff4444',
                    borderWidth: 2,
                    pointBackgroundColor: '#ff4444'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Break Time Pattern',
                        color: '#ffffff',
                        font: { size: 16 }
                    },
                    legend: {
                        labels: { color: '#ffffff' }
                    }
                },
                scales: {
                    r: {
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        pointLabels: { color: '#ffffff' },
                        angleLines: { color: 'rgba(255, 255, 255, 0.1)' }
                    }
                }
            }
        });
    }

    function createChartContainer(parent, id) {
        const container = document.createElement('div');
        container.className = 'chart-container';
        container.innerHTML = `<canvas id="${id}"></canvas>`;
        parent.appendChild(container);
        return container;
    }

function getProductivityData(days) {
    const labels = [];
    const scores = [];
    const now = moment();
    
    for (let i = days - 1; i >= 0; i--) {
        const date = moment().subtract(i, 'days');
        labels.push(date.format('MMM D'));
        
        // Calculate productivity score based on completed tasks and time spent
        const dayData = timeTracking.filter(entry => 
            moment(entry.timestamp).isSame(date, 'day')
        );
        
        const score = calculateProductivityScore(dayData);
        scores.push(score);
    }
    
    return { labels, scores };
}

function getTaskBreakdownData() {
    const taskTimes = {};
    const today = moment().startOf('day');
    
    // Filter for today's entries only
    timeTracking.forEach(entry => {
        if (entry.type === 'task' && moment(entry.timestamp).isSame(today, 'day')) {
            if (!taskTimes[entry.task]) {
                taskTimes[entry.task] = 0;
            }
            taskTimes[entry.task] += entry.duration / 3600; // Convert to hours
        }
    });
    
    return {
        labels: Object.keys(taskTimes),
        times: Object.values(taskTimes)
    };
}

function getWeeklyTrendsData() {
    const days = [];
    const completed = [];
    const timeSpent = [];
    
    for (let i = 6; i >= 0; i--) {
        const date = moment().subtract(i, 'days');
        days.push(date.format('ddd'));
        
        // Get tasks completed on this date
        const completedTasksCount = tasks.filter(task => 
            task.completed && 
            moment(task.completedAt).isSame(date, 'day')
        ).length;
        
        completed.push(completedTasksCount);
        
        // Time spent calculation remains the same
        const dayData = timeTracking.filter(entry => 
            moment(entry.timestamp).isSame(date, 'day')
        );
        
        timeSpent.push(dayData.reduce((sum, entry) => 
            sum + entry.duration / 3600, 0
        ));
    }
    
    return { days, completed, timeSpent };
}

function getBreakAnalysisData() {
    const timeSlots = [
        'Morning (6-10)',
        'Mid-day (10-2)',
        'Afternoon (2-6)',
        'Evening (6-10)',
        'Night (10-6)'
    ];
    
    const counts = timeSlots.map(() => 0);
    
    timeTracking.forEach(entry => {
        if (entry.type === 'break') {
            const hour = moment(entry.timestamp).hour();
            if (hour >= 6 && hour < 10) counts[0]++;
            else if (hour >= 10 && hour < 14) counts[1]++;
            else if (hour >= 14 && hour < 18) counts[2]++;
            else if (hour >= 18 && hour < 22) counts[3]++;
            else counts[4]++;
        }
    });
    
    return { timeSlots, counts };
}

function calculateProductivityScore(dayData) {
    if (!dayData.length) return 0;
    
    const totalTime = dayData.reduce((sum, entry) => sum + entry.duration, 0);
    const taskCount = dayData.filter(entry => entry.type === 'task').length;
    const breakRatio = dayData.filter(entry => entry.type === 'break')
        .reduce((sum, entry) => sum + entry.duration, 0) / totalTime;
    
    // Score calculation formula (customize as needed)
    return Math.min(100, 
        (taskCount * 20) + 
        (totalTime / 3600 * 10) + 
        (breakRatio >= 0.15 && breakRatio <= 0.25 ? 20 : 0)
    );
}
</script>

<!-- Add this HTML before the closing body tag -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <h2>Confirm Delete</h2>
        <p>Are you sure you want to delete this note?</p>
        <div class="modal-buttons">
            <button id="confirmDelete" class="btn btn-danger">Delete</button>
            <button id="cancelDelete" class="btn">Cancel</button>
        </div>
    </div>
</div>
</body>
</html>
